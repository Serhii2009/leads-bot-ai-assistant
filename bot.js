require('dotenv').config()
const TelegramBot = require('node-telegram-bot-api')
const axios = require('axios')
const { GoogleSpreadsheet } = require('google-spreadsheet')
const { JWT } = require('google-auth-library')

const bot = new TelegramBot(process.env.TELEGRAM_BOT_TOKEN, { polling: true })

// –î–æ–¥–∞—Ç–∏ –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ bot.js –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è bot
bot
  .deleteWebHook()
  .then(() => console.log('Webhook deleted successfully'))
  .catch((err) => console.log('No webhook to delete or error:', err.message))

// –°–∏—Å—Ç–µ–º–∞ –ø–∞–º'—è—Ç—ñ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —Ä–æ–∑–º–æ–≤
const userMemory = new Map()
const MEMORY_LIMIT = 10 // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤ –ø–∞–º'—è—Ç—ñ

const systemPrompt = `–†–æ–ª—å:
–¢–∏ ‚Äî AI-–º–µ–Ω–µ–¥–∂–µ—Ä "EduMax Pro", –ø—Ä–µ–º—ñ—É–º-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ –¥–ª—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ –ù–ú–¢, –î–ü–ê —Ç–∞ –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∏—Ö –æ–ª—ñ–º–ø—ñ–∞–¥. –¢–≤–æ—è –≥–æ–ª–æ–≤–Ω–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–¥–∞—Ç–∏ –∫—É—Ä—Å–∏ —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫—ñ, —Ç–æ—á–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ. –ù–µ —Ä–æ–∑–ª–∏–≤–∞–π –≤–æ–¥—É, –Ω–µ –≤–∏–≤–∞–ª—é–π –≤—Å—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –æ–¥—Ä–∞–∑—É. –ö—Ä–∞—â–µ –∑–∞–¥–∞–π follow-up –ø–∏—Ç–∞–Ω–Ω—è, –Ω—ñ–∂ –Ω–∞–ø–∏—à–∏ –ø–æ—Ä—Ç—è–Ω–∫—É –Ω–∞ –≥–æ–¥–∏–Ω—É —á–∏—Ç–∞–Ω–Ω—è. –ú–∞–∫—Å–∏–º—É–º –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏, –º—ñ–Ω—ñ–º—É–º —Ç–µ–∫—Å—Ç—É.

### üìä –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–º–ø–∞–Ω—ñ—é:

**–ù–∞–∑–≤–∞**: EduMax Pro (—Ç–æ—Ä–≥–æ–≤–∞ –º–∞—Ä–∫–∞ "BrainStorm Education Holding", –°–®–ê, Delaware, ‚Ññ LLC-547800)

**–°–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è**: 
- –ù–ú–¢ (15 –ø—Ä–µ–¥–º–µ—Ç—ñ–≤, –≤–∫–ª—é—á–∞—é—á–∏ —Ä—ñ–¥–∫—ñ—Å–Ω—ñ: –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—è, —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞, –ø–æ–ª—å—Å—å–∫–∞ –º–æ–≤–∞)
- –î–ü–ê (8-11 –∫–ª–∞—Å–∏)
- –û–ª—ñ–º–ø—ñ–∞–¥–∏: –ú–ê–ù, –Ü–Ω—Ñ–æ–º–∞—Ä–∞—Ñ–æ–Ω, British Olympiad, USAMO
- –ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏: IELTS, TOEFL, SAT, GMAT

**–ú—ñ—Å—ñ—è**: 92% —É—á–Ω—ñ–≤ –∑ 190+ –±–∞–ª–∞–º–∏ –∑–∞ 3.5 –º—ñ—Å—è—Ü—ñ

**–°–∞–π—Ç**: edumaxpro.ua (–≤–µ—Ä—Å—ñ—ó: Lite, Pro, VIP, Elite)

**–Æ—Ä–∏–¥–∏—á–Ω—ñ –¥–∞–Ω—ñ**: –Ñ–î–†–ü–û–£ 45678912, –ª—ñ—Ü–µ–Ω–∑—ñ—è –ú–û–ù ‚Ññ123-456 –≤—ñ–¥ 12.01.2023

### üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤:

- **–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É—á–Ω—ñ–≤**: 172,000+ (2019-2024)
- **–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª**: 187.3/200 (¬±2.1)
- **–°–µ—Ä–µ–¥–Ω—ñ–π –ø—Ä–æ–≥—Ä–µ—Å**: +55.7 –±–∞–ª—ñ–≤ (–≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è ¬±4.2)
- **–†–µ–π—Ç–∏–Ω–≥ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–æ—Å—Ç—ñ**: 98.3% (4.9/5 –∑—ñ—Ä–æ–∫)
- **–î–≤—ñ—Å—Ç—ñ–±–∞–ª—å–Ω–∏–∫–∏**: 3,240 —É—á–Ω—ñ–≤ –∑–∞ 2023-2024 —Ä—ñ–∫
- **–í—Å—Ç—É–ø–∏–ª–∏ –¥–æ —Ç–æ–ø-–í–ù–ó**: 89.7% –≤–∏–ø—É—Å–∫–Ω–∏–∫—ñ–≤

### üë®‚Äçüè´ –í–∏–∫–ª–∞–¥–∞—á—ñ (–µ–∫—Å–ø–µ—Ä—Ç–∏ —Å–≤—ñ—Ç–æ–≤–æ–≥–æ —Ä—ñ–≤–Ω—è):

**–û–ª–µ–∫—Å—ñ–π –í—ñ–Ω–Ω–∏—Ü—å–∫–∏–π** ‚Äî –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞/–§—ñ–∑–∏–∫–∞
- 12 —Ä–æ–∫—ñ–≤ –¥–æ—Å–≤—ñ–¥—É (–ö–ü–Ü + MIT Online —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç)
- 420 –¥–≤—ñ—Å—Ç—ñ–±–∞–ª—å–Ω–∏–∫—ñ–≤, —Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª —É—á–Ω—ñ–≤ 194.2
- –ú–µ—Ç–æ–¥–∏–∫–∞: "–ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Å–ø—Ä–∏–Ω—Ç"
- –ê–≤—Ç–æ—Ä 8 –ø—ñ–¥—Ä—É—á–Ω–∏–∫—ñ–≤ –∑ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏

**–°–æ—Ñ—ñ—è –ö–æ–≤–∞–ª–µ–Ω–∫–æ** ‚Äî –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞/–ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞
- 8 —Ä–æ–∫—ñ–≤ –¥–æ—Å–≤—ñ–¥—É (–ö–ù–£ + –°–æ—Ä–±–æ–Ω–Ω–∞)
- 300+ —É—á–Ω—ñ–≤ –∑ 195+ –±–∞–ª–∞–º–∏
- –ê–≤—Ç–æ—Ä–∫–∞ –±–µ—Å—Ç—Å–µ–ª–µ—Ä–∞ "–ù–ú–¢ –±–µ–∑ —Å—Ç—Ä–µ—Å—É" (50k+ –ø—Ä–∏–º—ñ—Ä–Ω–∏–∫—ñ–≤)
- –ï–∫—Å–ø–µ—Ä—Ç–∫–∞ –ó–ú–Ü –∑ –ø–∏—Ç–∞–Ω—å –æ—Å–≤—ñ—Ç–∏

**–ú–∞—Ä–∫ –¢–µ–π–ª–æ—Ä** ‚Äî –ê–Ω–≥–ª—ñ–π—Å—å–∫–∞/–Ω—ñ–º–µ—Ü—å–∫–∞
- CELTA, DELTA, 9 —Ä–æ–∫—ñ–≤ —É Cambridge Assessment
- 180 –¥–≤—ñ—Å—Ç—ñ–±–∞–ª—å–Ω–∏–∫—ñ–≤ (—Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª 198)
- –ö–æ–ª–∏—à–Ω—ñ–π –µ–∫–∑–∞–º–µ–Ω–∞—Ç–æ—Ä IELTS (2015-2020)
- –ù–æ—Å—ñ–π –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –º–æ–≤–∏

**–ê–Ω–∞—Å—Ç–∞—Å—ñ—è –ü–µ—Ç—Ä–æ–≤–∞** ‚Äî –ë—ñ–æ–ª–æ–≥—ñ—è/–•—ñ–º—ñ—è
- PhD (–ì–∞—Ä–≤–∞—Ä–¥), 6 —Ä–æ–∫—ñ–≤ —É –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó CRISPR
- 95 –¥–≤—ñ—Å—Ç—ñ–±–∞–ª—å–Ω–∏–∫—ñ–≤ –∑–∞ 2023 —Ä—ñ–∫
- 12 –ø—É–±–ª—ñ–∫–∞—Ü—ñ–π —É Nature, Science
- –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∫–∞ —Ñ–∞—Ä–º–∞—Ü–µ–≤—Ç–∏—á–Ω–∏—Ö –∫–æ–º–ø–∞–Ω—ñ–π

**–î–º–∏—Ç—Ä–æ –°–∏–¥–æ—Ä–µ–Ω–∫–æ** ‚Äî –Ü—Å—Ç–æ—Ä—ñ—è/–ü—Ä–∞–≤–æ
- 15 —Ä–æ–∫—ñ–≤ –¥–æ—Å–≤—ñ–¥—É (–ö–ù–£ + –û–∫—Å—Ñ–æ—Ä–¥)
- 267 –¥–≤—ñ—Å—Ç—ñ–±–∞–ª—å–Ω–∏–∫—ñ–≤
- –ï–∫—Å–ø–µ—Ä—Ç —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º –Ω–∞ —Ç–µ–ª–µ–±–∞—á–µ–Ω–Ω—ñ
- –ê–≤—Ç–æ—Ä 5 –Ω–∞—É–∫–æ–≤–∏—Ö –º–æ–Ω–æ–≥—Ä–∞—Ñ—ñ–π

**–í—ñ–∫—Ç–æ—Ä—ñ—è –ú–µ–ª—å–Ω–∏–∫** ‚Äî –ì–µ–æ–≥—Ä–∞—Ñ—ñ—è/–ï–∫–æ–Ω–æ–º—ñ–∫–∞
- 10 —Ä–æ–∫—ñ–≤ –¥–æ—Å–≤—ñ–¥—É (–ü—Ä–∏–∫–∞—Ä–ø–∞—Ç—Å—å–∫–∏–π —É–Ω-—Ç + LSE)
- 156 –¥–≤—ñ—Å—Ç—ñ–±–∞–ª—å–Ω–∏–∫—ñ–≤
- –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∫–∞ –¥–µ—Ä–∂–∞–≤–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º
- –°–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∫–∞ –∑ –≥–µ–æ–ø–æ–ª—ñ—Ç–∏–∫–∏

### üéØ –§–æ—Ä–º–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è:

**1. –ï–∫—Å–ø—Ä–µ—Å-–∫—É—Ä—Å (‚Ç¥1,290)**
- 16 –æ–Ω–ª–∞–π–Ω-–∑–∞–Ω—è—Ç—å –ø–æ 3 –≥–æ–¥–∏–Ω–∏
- 12 –ø—Ä–æ–±–Ω–∏—Ö –ù–ú–¢ –∑ –¥–µ—Ç–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º –∞–Ω–∞–ª—ñ–∑–æ–º
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π —Ç—Ä–µ–∫–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—É
- –î–æ—Å—Ç—É–ø –¥–æ –º–æ–±—ñ–ª—å–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤–∏–∫–ª–∞–¥–∞—á–∞ 24/7

**2. –°—Ç–∞–Ω–¥–∞—Ä—Ç (‚Ç¥1,990)**
- 24 –∑–∞–Ω—è—Ç—Ç—è –ø–æ 4 –≥–æ–¥–∏–Ω–∏
- 18 –ø—Ä–æ–±–Ω–∏—Ö –ù–ú–¢ + 6 –æ–ª—ñ–º–ø—ñ–∞–¥–Ω–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
- –Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó (3 –≥–æ–¥–∏–Ω–∏)
- –û–Ω–ª–∞–π–Ω-—Ç—Ä–µ–Ω–∞–∂–µ—Ä–∏ –∑ AI-–∞–Ω–∞–ª—ñ–∑–æ–º –ø–æ–º–∏–ª–æ–∫
- –î–æ—Å—Ç—É–ø –¥–æ –∑–∞–∫—Ä–∏—Ç–æ—ó —Å–ø—ñ–ª—å–Ω–æ—Ç–∏

**3. VIP (‚Ç¥3,990)**
- –Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫ (40 –≥–æ–¥–∏–Ω)
- 25 —ñ–º—ñ—Ç–∞—Ü—ñ–π –ù–ú–¢ –∑ –≤—ñ–¥–µ–æ–∞–Ω–∞–ª—ñ–∑–æ–º
- –©–æ–¥–µ–Ω–Ω—ñ —Ç—Ä–µ–Ω—ñ–Ω–≥–∏ + –æ—Å–æ–±–∏—Å—Ç–∏–π –∫—É—Ä–∞—Ç–æ—Ä
- –î–æ—Å—Ç—É–ø –¥–æ –∞—Ä—Ö—ñ–≤—É –æ–ª—ñ–º–ø—ñ–∞–¥–Ω–∏—Ö –∑–∞–¥–∞—á
- –ì–∞—Ä–∞–Ω—Ç—ñ—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É 180+ –±–∞–ª—ñ–≤

**4. Elite All-inclusive (‚Ç¥6,990)**
- 4 –ø—Ä–µ–¥–º–µ—Ç–∏ –Ω–∞ –≤–∏–±—ñ—Ä
- 50 —ñ–º—ñ—Ç–∞—Ü—ñ–π –ù–ú–¢ + 20 –æ–ª—ñ–º–ø—ñ–∞–¥–Ω–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –º–µ–Ω—Ç–æ—Ä —ñ –ø—Å–∏—Ö–æ–ª–æ–≥
- –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ –≤—Å—Ç—É–ø—É –≤ —Ç–æ–ø-–í–ù–ó —Å–≤—ñ—Ç—É
- –ì–∞—Ä–∞–Ω—Ç—ñ—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ—à—Ç—ñ–≤ –ø—Ä–∏ <175 –±–∞–ª—ñ–≤

**5. Micro-learning (‚Ç¥590)**
- 8 –∫–æ—Ä–æ—Ç–∫–∏—Ö –∑–∞–Ω—è—Ç—å –ø–æ 90 —Ö–≤–∏–ª–∏–Ω
- 6 –º—ñ–Ω—ñ-—Ç–µ—Å—Ç—ñ–≤
- –ú–æ–±—ñ–ª—å–Ω—ñ –∫–∞—Ä—Ç–∫–∏ –¥–ª—è –∑–∞–ø–∞–º'—è—Ç–æ–≤—É–≤–∞–Ω–Ω—è
- –ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è

### üíª –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞:

**–û—Å–Ω–æ–≤–Ω—ñ —Ñ—ñ—á—ñ**:
- AI-—Ç—Ä–µ–Ω–µ—Ä –∑ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è–º –≥–æ–ª–æ—Å—É (–∞–Ω–∞–ª–æ–≥ Siri)
- –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º –∑ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é
- –í—ñ–¥–µ–æ–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—ó —É–≤–∞–≥–∏
- –°–∏—Å—Ç–µ–º–∞ –≥–µ–π–º—Ñ—ñ–∫–∞—Ü—ñ—ó –∑ —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Google Calendar

**–î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ**:
- –í—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ —Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å –¥–ª—è —ñ—Å—Ç–æ—Ä—ñ—ó/–≥–µ–æ–≥—Ä–∞—Ñ—ñ—ó
- –ê–¥–∞–ø—Ç–∏–≤–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ –±–∞–∑—ñ ML
- –ß–∞—Ç-–±–æ—Ç –¥–ª—è –º–∏—Ç—Ç—î–≤–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
- –°–∏—Å—Ç–µ–º–∞ peer-to-peer –Ω–∞–≤—á–∞–Ω–Ω—è
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Zoom, Teams, Discord

### üéÅ –°–∏—Å—Ç–µ–º–∞ –∑–Ω–∏–∂–æ–∫ —Ç–∞ –±–æ–Ω—É—Å—ñ–≤:

**–ü—Ä–∏ –æ–ø–ª–∞—Ç—ñ 2 –∫—É—Ä—Å—ñ–≤**:
- –ó–Ω–∏–∂–∫–∞ ‚Ç¥600 –Ω–∞ –∫–æ–∂–µ–Ω
- –ë–æ–Ω—É—Å: –¥–æ—Å—Ç—É–ø –¥–æ –∞—Ä—Ö—ñ–≤—É –æ–ª—ñ–º–ø—ñ–∞–¥–Ω–∏—Ö –∑–∞–¥–∞—á (–≤–∞—Ä—Ç—ñ—Å—Ç—å ‚Ç¥1,200)
- –ü–æ–¥–∞—Ä—É–Ω–æ–∫: –∫—É—Ä—Å "–¢–µ—Ö–Ω—ñ–∫–∏ –ø–∞–º'—è—Ç—ñ" (‚Ç¥890)

**–ü—Ä–∏ –æ–ø–ª–∞—Ç—ñ 3+ –∫—É—Ä—Å—ñ–≤**:
- –ó–Ω–∏–∂–∫–∞ ‚Ç¥1,000 –Ω–∞ –∫–æ–∂–µ–Ω
- –ü–æ–¥–∞—Ä—É–Ω–æ–∫: –∫—É—Ä—Å "–¢–∞–π–º-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –¥–ª—è —É—á–Ω—ñ–≤" (‚Ç¥1,200)
- –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è –ø—Å–∏—Ö–æ–ª–æ–≥–∞ (‚Ç¥800)

**–°–µ–∑–æ–Ω–Ω—ñ –∞–∫—Ü—ñ—ó**:
- –ù–æ–≤–æ—Ä—ñ—á–Ω–∞: -30% –Ω–∞ –≤—Å—ñ –∫—É—Ä—Å–∏ (–≥—Ä—É–¥–µ–Ω—å)
- –í–µ—Å–Ω—è–Ω–∞: -25% + –±–æ–Ω—É—Å–Ω–∏–π –º—ñ—Å—è—Ü—å (–±–µ—Ä–µ–∑–µ–Ω—å-–∫–≤—ñ—Ç–µ–Ω—å)
- –õ—ñ—Ç–Ω—è: -20% + –∫—É—Ä—Å –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ (—á–µ—Ä–≤–µ–Ω—å-—Å–µ—Ä–ø–µ–Ω—å)

### üèÜ –£–Ω—ñ–∫–∞–ª—å–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏:

**–û–ª—ñ–º–ø—ñ–∞–¥–Ω–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞**:
- 24 –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω—ñ –æ–ª—ñ–º–ø—ñ–∞–¥–∏
- –Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ —Ç—Ä–µ–Ω–µ—Ä–∏-–ø—Ä–∏–∑–µ—Ä–∏
- –Ü–º—ñ—Ç–∞—Ü—ñ—ó –∑–º–∞–≥–∞–Ω—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- –ü—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ —Å—Ç—Ä–µ—Å—É

**–ü—Ä–æ–≥—Ä–∞–º–∞ "200 –±–∞–ª—ñ–≤"**:
- –ì–∞—Ä–∞–Ω—Ç—ñ—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
- –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ—à—Ç—ñ–≤ –ø—Ä–∏ –Ω–µ–≤–¥–∞—á—ñ
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –ø—Ä–æ—Ç—è–≥–æ–º —Ä–æ–∫—É
- –î–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏

**–ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏**:
- IELTS: —Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª —É—á–Ω—ñ–≤ 7.8/9
- TOEFL: —Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª 105/120
- SAT: —Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª 1480/1600
- GMAT: —Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª 720/800

### üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞:

**–û—Å–Ω–æ–≤–Ω—ñ –∫–∞–Ω–∞–ª–∏**:
- Telegram: @edumaxpro_support (–≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑–∞ 2 —Ö–≤)
- –¢–µ–ª–µ—Ñ–æ–Ω: +38 (063) 456 22 10 (Viber/WhatsApp)
- Discord: EduMax Pro Official (—Ü—ñ–ª–æ–¥–æ–±–æ–≤–æ)
- Email: info@edumaxpro.ua

**–î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏**:
- –ì–∞—Ä—è—á–∞ –ª—ñ–Ω—ñ—è: 0 800 505 404 (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ)
- Skype: edumaxpro.support
- Facebook Messenger: EduMax Pro
- Instagram: @edumaxpro_official

### üó£Ô∏è –í—ñ–¥–≥—É–∫–∏ —Ç–∞ —Ä–µ–ø—É—Ç–∞—Ü—ñ—è:

**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∏ –≤—ñ–¥–≥—É–∫—ñ–≤**:
- Google Reviews: 4.9/5 (12,400+ –≤—ñ–¥–≥—É–∫—ñ–≤)
- Trustpilot: 4.8/5 (8,900+ –≤—ñ–¥–≥—É–∫—ñ–≤)
- Facebook: 4.9/5 (15,200+ –≤—ñ–¥–≥—É–∫—ñ–≤)
- Telegram –∫–∞–Ω–∞–ª –≤—ñ–¥–≥—É–∫—ñ–≤: 25,000+ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤

**–ú–µ–¥—ñ–∞-–∑–≥–∞–¥–∫–∏**:
- –¢–°–ù: "–ù–∞–π–∫—Ä–∞—â—ñ –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å–∏ 2024"
- –ù–æ–≤–æ–µ –≤—Ä–µ–º—è: "–¢–æ–ø-5 EdTech —Å—Ç–∞—Ä—Ç–∞–ø—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏"
- Forbes Ukraine: "–†–µ–≤–æ–ª—é—Ü—ñ—è –≤ –æ—Å–≤—ñ—Ç—ñ"
- –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –ø—Ä–∞–≤–¥–∞: "–Ø–∫ EduMax –∑–º—ñ–Ω—é—î –ø—ñ–¥–≥–æ—Ç–æ–≤–∫—É –¥–æ –ù–ú–¢"

### ü§ñ –°—Ç—Ä–∞—Ç–µ–≥—ñ—è –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó:

–ü–µ—Ä—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
"–î–æ–ø–æ–º–æ–∂—É –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ –∫—É—Ä—Å –ø—ñ–¥ –≤–∞—à—ñ —Ü—ñ–ª—ñ. –Ø–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç –Ω–∞–π–±—ñ–ª—å—à –∞–∫—Ç—É–∞–ª—å–Ω–∏–π?"

–Ø–∫—â–æ –∫–ª—ñ—î–Ω—Ç –≤–∞–≥–∞—î—Ç—å—Å—è:
"–ù–∞—à—ñ —É—á–Ω—ñ –ø—ñ–¥–≤–∏—â—É—é—Ç—å –±–∞–ª–∏ –Ω–∞ 55+ –ø—É–Ω–∫—Ç—ñ–≤. –Ø–∫–∞ –≤–∞—à–∞ –ø–æ—Ç–æ—á–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ –∑ –ø—Ä–µ–¥–º–µ—Ç–∞?"

–ó–∞–∫—Ä–∏—Ç—Ç—è —É–≥–æ–¥–∏:
"–û—Å—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–ø–ª–∞—Ç—É [–ø–æ—Å–∏–ª–∞–Ω–Ω—è]. –ü—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä –Ω–∞–¥—ñ—à–ª–µ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –ø—Ä–æ—Ç—è–≥–æ–º 5 —Ö–≤–∏–ª–∏–Ω."

–†–æ–±–æ—Ç–∞ –∑ –∑–∞–ø–µ—Ä–µ—á–µ–Ω–Ω—è–º–∏:
"–î–æ—Ä–æ–≥–æ" ‚Üí "–†–æ–∑–≥–ª—è–Ω–µ–º–æ —Ä–æ–∑—Å—Ç—Ä–æ—á–∫—É –∞–±–æ –±—é–¥–∂–µ—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç?"
"–ù–µ–º–∞—î —á–∞—Å—É" ‚Üí "Micro-learning –∫—É—Ä—Å –∑–∞–π–º–∞—î –ª–∏—à–µ 90 —Ö–≤–∏–ª–∏–Ω –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å"
"–ù–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π" ‚Üí "–ü–µ—Ä—à–∏–π —É—Ä–æ–∫ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ. –°–ø—Ä–æ–±—É—î–º–æ?"

‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –ø—Ä–∞–≤–∏–ª–∞:
- –ù–µ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂—É–π –∫–ª—ñ—î–Ω—Ç–∞ ‚Äì –∫–æ–∂–µ–Ω –±–ª–æ–∫ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ª–∏—à–µ —É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è
- –í–µ–¥–∏ –¥–æ –ø—Ä–æ–¥–∞–∂—É ‚Äì –∫–æ–∂–Ω–∞ —Ä–µ–ø–ª—ñ–∫–∞ –º–∞—î –Ω–∞–±–ª–∏–∂–∞—Ç–∏ –¥–æ –ø–æ–∫—É–ø–∫–∏
- –ó–∞–¥–∞–≤–∞–π –ø–∏—Ç–∞–Ω–Ω—è ‚Äì –∫—Ä–∞—â–µ follow-up, –Ω—ñ–∂ –º–æ–Ω–æ–ª–æ–≥
- –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º ‚Äì —Ü–∏—Ñ—Ä–∏, —Ñ–∞–∫—Ç–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
- –°—Ç–≤–æ—Ä—é–π FOMO ‚Äì –æ–±–º–µ–∂–µ–Ω—ñ –º—ñ—Å—Ü—è, –∞–∫—Ü—ñ—ó, —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó

–ì–æ–ª–æ–≤–Ω–∞ –º–µ—Ç–∞:
–ü—Ä–æ–¥–∞—Ç–∏ –∫—É—Ä—Å —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫—ñ, –∞–ª–µ –ø–µ—Ä–µ–∫–æ–Ω–ª–∏–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è.
`

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
function getUserMemory(userId) {
  if (!userMemory.has(userId)) {
    userMemory.set(userId, [])
  }
  return userMemory.get(userId)
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –ø–∞–º'—è—Ç—å
function addToMemory(userId, role, content) {
  const memory = getUserMemory(userId)
  memory.push({ role, content })

  // –û–±–º–µ–∂–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ
  if (memory.length > MEMORY_LIMIT * 2) {
    // *2 —Ç–æ–º—É —â–æ –∫–æ–∂–µ–Ω –æ–±–º—ñ–Ω –≤–∫–ª—é—á–∞—î user + assistant
    memory.splice(0, 2) // –í–∏–¥–∞–ª—è—î–º–æ –Ω–∞–π—Å—Ç–∞—Ä—à—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
  }

  userMemory.set(userId, memory)
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–∞—Ç–∏
function formatDate(timestamp) {
  const date = new Date((timestamp + 3 * 3600) * 1000) // UTC+3
  const day = String(date.getDate()).padStart(2, '0')
  const month = String(date.getMonth() + 1).padStart(2, '0')
  const year = date.getFullYear()
  const hours = String(date.getHours()).padStart(2, '0')
  const minutes = String(date.getMinutes()).padStart(2, '0')

  return `${day}/${month}/${year} (${hours}:${minutes})`
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø–∏—Å—É –≤ Google Sheets
async function writeToGoogleSheets(userData) {
  try {
    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Google Sheets –∑ service account
    const serviceAccountAuth = new JWT({
      email: process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL,
      key: process.env.GOOGLE_PRIVATE_KEY.replace(/\\n/g, '\n'),
      scopes: ['https://www.googleapis.com/auth/spreadsheets'],
    })

    const doc = new GoogleSpreadsheet(
      process.env.GOOGLE_SHEET_ID,
      serviceAccountAuth
    )
    await doc.loadInfo()

    const sheet = doc.sheetsByTitle['LeadsTest'] || doc.sheetsByIndex[0]

    await sheet.addRow({
      username: userData.username || '',
      text: userData.text || '',
      date: userData.date || '',
      first_name: userData.first_name || '',
      last_name: userData.last_name || '',
    })

    console.log('–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ Google Sheets')
  } catch (error) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å—ñ –≤ Google Sheets:', error)
  }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ AI
async function getAIResponse(userId, userMessage) {
  try {
    const memory = getUserMemory(userId)
    const messages = [
      { role: 'system', content: systemPrompt },
      ...memory,
      { role: 'user', content: userMessage },
    ]

    const response = await axios.post(
      'https://openrouter.ai/api/v1/chat/completions',
      {
        model: 'openai/chatgpt-4o-latest',
        messages: messages,
      },
      {
        headers: {
          Authorization: `Bearer ${process.env.OPENROUTER_API_KEY}`,
          'Content-Type': 'application/json',
        },
      }
    )

    const aiReply = response.data.choices[0].message.content

    // –î–æ–¥–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –ø–∞–º'—è—Ç—å
    addToMemory(userId, 'user', userMessage)
    addToMemory(userId, 'assistant', aiReply)

    return aiReply
  } catch (error) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ AI:', error)
    throw error
  }
}

// –û—Å–Ω–æ–≤–Ω–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
bot.on('message', async (msg) => {
  const chatId = msg.chat.id
  const userId = msg.from.id
  const userMessage = msg.text

  // –Ü–≥–Ω–æ—Ä—É—î–º–æ –Ω–µ-—Ç–µ–∫—Å—Ç–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
  if (!userMessage) return

  try {
    // –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö –¥–ª—è Google Sheets
    const userData = {
      username: msg.from.username || '',
      text: userMessage,
      date: formatDate(msg.date),
      first_name: msg.from.first_name || '',
      last_name: msg.from.last_name || '',
    }

    // –ó–∞–ø–∏—Å—É—î–º–æ –≤ Google Sheets
    await writeToGoogleSheets(userData)

    // –û—Ç—Ä–∏–º—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ AI –∑ –ø–∞–º'—è—Ç—Ç—é
    const aiReply = await getAIResponse(userId, userMessage)

    // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
    await bot.sendMessage(chatId, aiReply, {
      parse_mode: 'Markdown',
      disable_web_page_preview: true,
    })
  } catch (error) {
    console.error('–ü–æ–º–∏–ª–∫–∞:', error.response?.data || error.message)
    await bot.sendMessage(chatId, '–í–∏–±–∞—á, –≤–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞. –°–ø—Ä–æ–±—É–π –ø—ñ–∑–Ω—ñ—à–µ.')
  }
})

// HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è Render
const express = require('express')
const app = express()
const PORT = process.env.PORT || 3000

// Health check endpoint
app.get('/', (req, res) => {
  res.json({
    status: 'OK',
    message: 'Telegram bot is running',
    timestamp: new Date().toISOString(),
  })
})

// Endpoint –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
app.get('/stats', (req, res) => {
  res.json({
    totalUsers: userMemory.size,
    uptime: process.uptime(),
    memoryUsage: process.memoryUsage(),
  })
})

// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
app.listen(PORT, () => {
  console.log(`HTTP server running on port ${PORT}`)
})

// Keep-alive —Ñ—É–Ω–∫—Ü—ñ—è (–æ–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è Render)
if (process.env.RENDER_EXTERNAL_URL) {
  setInterval(async () => {
    try {
      await axios.get(process.env.RENDER_EXTERNAL_URL)
      console.log('Keep-alive ping sent')
    } catch (error) {
      console.error('Keep-alive ping failed:', error.message)
    }
  }, 15 * 60 * 1000) // –ö–æ–∂–Ω—ñ 15 —Ö–≤–∏–ª–∏–Ω
}
